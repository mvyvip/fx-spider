package com;

import com.eclipsesource.v8.V8;
import javax.script.Invocable;
import javax.script.ScriptEngine;
import javax.script.ScriptEngineManager;

/**
 * Created by lt on 2018/11/6 0006.
 */
public class V8Test {

    public static void main(String[] args) throws Exception {
        ScriptEngineManager sem = new ScriptEngineManager();
        ScriptEngine se = sem.getEngineByName("javascript");
        try {
            String script = "function xxx() {\n"
                + "\t\tvar cookie = '__jsl_clearance=1541487148.661|0|' + (function() {\n"
                + "\t\t\treturn ['BJkxD', ['' + [] + []][0].charAt((( - ~ {} << -~ {}) ^ ( + !''))) + (![] + [[]][0]).charAt(2) + ('' + [] + [[]][0]).charAt( - ~ {} + ( + !'') + 4) + [{} + []][0].charAt( - ~ {} + ( - ~ {} << ( - ~ !! [][[]] + [( - ~ {} << -~ {})] >> ( - ~ {} << -~ {})))), 'PX', [{} + []][0].charAt( - ~ {} + ( - ~ {} << ( - ~ !! [][[]] + [( - ~ {} << -~ {})] >> ( - ~ {} << -~ {})))) + ((( - ~ !! [][[]] + [2] >> 2)) / ~~ [] + [[]][0]).charAt(~~ {}) + (![] + [] + [[]][0]).charAt((( - ~ {} << -~ {}) ^ ( + !''))), 'E', [{} + [[]][0]][0].charAt(3), 'UG', [!( + []) + [] + []][0].charAt(( + [])), 'EvEMk', ((( - ~ !! [][[]] + [2] >> 2)) / ~~ [] + [] + [[]][0]).charAt( - ~ - ~ {} + 5) + [[{}][1] + [] + []][0].charAt(4) + [{} + [[]][0]][0].charAt([ - ~ []] + [ - ~ - ~ {}]), '%', ((( - ~ {} << -~ {}) ^ ( + !'')) + [] + []), 'D'].join('')\n"
                + "\t\t})() + ';Expires=Tue, 06-Nov-18 07:52:28 GMT;Path=/;'\n"
                + "\t\treturn cookie;\n"
                + "\t};";

            script = "function xxx() {\n"
                + "\t\tvar cookie = '__jsl_clearance=1541493968.508|0|' + (function() {\n"
                + "\t\t\treturn [[ - ~ [ - ~ [5]]], 'pS', [{} + [[]][0]][0].charAt([ - ~ []] + [ - ~ - ~ {}]), 'X', ((( - ~ !! [][[]] + [2] >> 2)) / ~~ [] + [] + [[]][0]).charAt( - ~ - ~ {} + 5) + (~~ ! {}\n"
                + "\t\t\t/~~!{}+[[]][0]).charAt(~~'')+[-~((-~{}<<(-~{}<<-~{})))]+(window.headless+[]+[[]][0]).charAt(-~{}+(+!'')+4),'E',[{}+[]][0].charAt(-~{}+(-~{}<<(-~!![][[]]+[(-~{}<<-~{})]>>(-~{}<<-~{}))))+[{}+[[]][0]][0].charAt(3),'k',[{}+[]][0].charAt(-~{}+(-~{}<<(-~!![][[]]+[(-~{}<<-~{})]>>(-~{}<<-~{})))),'hV',[{}+[]+[[]][0]][0].charAt(-~~~{}-~~~{}+(-~{}+[-~-~{}])/ [ - ~ - ~ {}]) + [ - ~ - ~ {}], 'qHJQkv', [!/!/ + [[]][0]][0].charAt(( + !'')), '%', [ - ~ - ~ {}], 'B', [{} + [[]][0]][0].charAt([ - ~ []] + [ - ~ - ~ {}]), '%', ((( - ~ {} << -~ {}) ^ ( + !'')) + [] + []), 'D'].join('')\n"
                + "\t\t})() + ';Expires=Tue, 06-Nov-18 09:46:08 GMT;Path=/;'\n"
                + "\t\treturn cookie;\n"
                + "\t};";

            se.eval(script);
            Invocable inv2 = (Invocable) se;
            String res = (String) inv2.invokeFunction("xxx");
            System.out.println(res);


            String s="<script>var x=\"@__jsl_clearance@_p@@Tue@while@@@JgSe0upZ@window@createElement@@@div@Array@length@document@@0xFF@if@@0@return@@location@@setTimeout@for@GMT@@@replace@else@@@1541493746@cookie@fromCharCode@2@captcha@charAt@firstChild@f@@@06@a@@reverse@@26@@1500@hantom@@0xEDB88320@parseInt@@try@@rOm9XFMtA3QKV7nYsPGT4lifyWwkq5vcjH2IdxUoCbhERLaz81DNB6@@JT@eval@RegExp@@@1@@8@innerHTML@join@@g@@42@DKP@e@Gh@73@18@chars@@qk@d@@@toLowerCase@@@new@@@FWZ@toString@function@pathname@charCodeAt@36@String@catch@@onreadystatechange@split@https@challenge@@Path@attachEvent@@var@Nov@A@@search@false@substr@addEventListener@MwM@@D@DOMContentLoaded@09@@Expires@href@FE@match\".replace(/@*$/,\"\").split(\"@\"),y=\"33 3c=2o(){r('p.3i=p.2p+p.37.w(/[\\\\?|&]14-2y/,\\\\'\\\\')',1h);h.11='2=10.28|m|'+(2o(){n ['27',[-~![]/~~{}+[[]][m]][m].15((+!{})),'%',(-~-~~~[]+[]),'3j%',(-~-~~~[]+[]),'2m',[-~![]/~~{}+[[]][m]][m].15((+!{}))+(+[-~{}, ~~![]]+[]).15(-~~~[])+[-~![]/~~{}+[[]][m]][m].15((+!{})),'2c',[((-~[]|(-~~~[]<<-~~~[])))/~~[]+[]+[[]][m]][m].15(-~[-~-~~~[]]+(-~~~[]-~~~[]<<-~![])),'35',[((+!+[])+[13]>>13)],'1r',(([13]+~~[]>>13)+[]),'25',[a['3'+'1i']+[[]][m]][m].15(([13]+~~[]>>13))+(-~[-~~~[]-~~~[]-~[-~~~[]-~~~[]]]+[]+[]),'3b%',[((+!+[])+[13]>>13)],'3d'].20('')})()+';3h=5, 1a-34-29 3f:24:1f t;30=/;'};k((2o(){1n{n !!a.3a;}2t(26){n 38;}})()){h.3a('3e',3c,38)}x{h.31('2v',3c)}\",f=function(x,y){var a=0,b=0,c=0;x=x.split(\"\");y=y||99;while((a=x.shift())&&(b=a.charCodeAt(0)-77.5))c=(Math.abs(b)<13?(b+48.5):parseInt(a,36))+y*c;return c},z=f(y.match(/\\w/g).sort(function(x,y){return f(x)-f(y)}).pop());while(z++)try{return(y.replace(/\\b\\w+\\b/g, function(y){return x[f(y,z)-1]||(\"_\"+y)}));break}catch(_){}</script>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ";
//    s = "<script>var x=\"f@chars@captcha@split@function@try@36@@fromCharCode@@String@onreadystatechange@@53@0@@@7@@@href@@d@8@for@08@createElement@match@06@document@@attachEvent@@join@pathname@@if@@Path@a@@setTimeout@@length@cookie@while@@reverse@false@vVJh@firstChild@replace@https@@18@parseInt@RegExp@ZHx@@@@rOm9XFMtA3QKV7nYsPGT4lifyWwkq5vcjH2IdxUoCbhERLaz81DNB6@@Ugm@1541488553@substr@@challenge@@@div@GMT@addEventListener@@Nov@@catch@wE@charCodeAt@innerHTML@@new@15@eval@@toLowerCase@@@JgSe0upZ@@@var@@@return@charAt@__jsl_clearance@search@@window@@Tue@location@else@Array@toString@@D@0xFF@@g@e@Expires@@DOMContentLoaded@@@1500@@0xEDB88320@4@797@EVY@@@2@@1\".replace(/@*$/,\"\").split(\"@\"),y=\"1J 10=5(){G('29.l=29.z+29.24.15(/[\\\\?|&]3-1l/,\\\\'\\\\')',2o);u.J='23=1i.2s|f|'+(5(){21 ['1v',[[][[]]+[]+[[]][f]][f].22(-~~~'')+[{}+[]+[]][f].22(-~-~![]+(-~![]+[(-~~~''<<-~~~'')])/[(-~~~''<<-~~~'')]),'13',[(2w^-~![])],'2t',[{}+[]+[]][f].22(-~(-~((-~-~![]^-~![]))-~((-~-~![]^-~![])))),'1b',({}+[]).22(-~[])+({}+[]).22(-~[])+[!-{}+[]+[[]][f]][f].22((+!{}))+[+[(+!{}), (+!{})]+[]+[[]][f]][f].22(~~'')+[{}+[]+[]][f].22(-~-~![]+(-~![]+[(-~~~''<<-~~~'')])/[(-~~~''<<-~~~'')])+[-~[i]],'1h',[2r]+[2r],'%',[(2w^-~![])],'2e'].y('')})()+';2j=28, t-1s-18 q:1A:e 1p;D=/;'};B((5(){6{21 !!26.1q;}1u(2i){21 12;}})()){u.1q('2l',10,12)}2a{u.w('c',10)}\",f=function(x,y){var a=0,b=0,c=0;x=x.split(\"\");y=y||99;while((a=x.shift())&&(b=a.charCodeAt(0)-77.5))c=(Math.abs(b)<13?(b+48.5):parseInt(a,36))+y*c;return c},z=f(y.match(/\\w/g).sort(function(x,y){return f(x)-f(y)}).pop());while(z++)try{eval(y.replace(/\\b\\w+\\b/g, function(y){return x[f(y,z)-1]||(\"_\"+y)}));break}catch(_){}</script> ";
//        s = "<script>var x=\"f@chars@captcha@split@function@try@36@@fromCharCode@@String@onreadystatechange@@30@0@@@BXwR@@@href@@d@8@for@18@createElement@match@Tue@document@@attachEvent@@join@pathname@@if@@Path@a@@setTimeout@@length@cookie@while@@reverse@false@2@firstChild@replace@https@@Nov@parseInt@RegExp@p@@@@rOm9XFMtA3QKV7nYsPGT4lifyWwkq5vcjH2IdxUoCbhERLaz81DNB6@@LU@1541492310@substr@@challenge@@@div@GMT@addEventListener@@06@@catch@VW@charCodeAt@innerHTML@@new@09@eval@@toLowerCase@@@JgSe0upZ@@@var@@@return@charAt@__jsl_clearance@search@@window@@D@location@else@Array@toString@@SwTgPY@0xFF@@g@e@Expires@@DOMContentLoaded@@@1500@@0xEDB88320@GY@538@4@@@XY@@1\".replace(/@*$/,\"\").split(\"@\"),y=\"1J 10=5(){G('29.l=29.z+29.24.15(/[\\\\?|&]3-1l/,\\\\'\\\\')',2o);u.J='23=1i.2s|f|'+(5(){21 [[{}+[]+[]][f].22(-~(-~((-~-~![]^-~![]))-~((-~-~![]^-~![])))),'1v',(((13^-~![]))/(+[])+[[]][f]).22((-~{}|-~-~![])-~((-~-~![]^-~![]))),'2w',[[][[]]+[]+[[]][f]][f].22(-~~~'')+[[][[]]+[]][f].22(2t),'1b',[!-{}+[]+[[]][f]][f].22((+!{})),'%',((-~~~''<<-~~~'')+[[]][f]),'i',[{}+[]+[]][f].22(-~-~![]+(-~![]+[(-~~~''<<-~~~'')])/[(-~~~''<<-~~~'')]),'1h',((-~~~''<<-~~~'')+[[]][f]),'2r',[-~~~''+[-~-~![]]*(((-~~~''<<-~~~'')^-~![]))],'2e%',[(13^-~![])],'28'].y('')})()+';2j=t, 1s-18-q 1A:q:e 1p;D=/;'};B((5(){6{21 !!26.1q;}1u(2i){21 12;}})()){u.1q('2l',10,12)}2a{u.w('c',10)}\",f=function(x,y){var a=0,b=0,c=0;x=x.split(\"\");y=y||99;while((a=x.shift())&&(b=a.charCodeAt(0)-77.5))c=(Math.abs(b)<13?(b+48.5):parseInt(a,36))+y*c;return c},z=f(y.match(/\\w/g).sort(function(x,y){return f(x)-f(y)}).pop());while(z++)try{eval(y.replace(/\\b\\w+\\b/g, function(y){return x[f(y,z)-1]||(\"_\"+y)}));break}catch(_){}</script>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ";
            String resHtml = "function getClearance(){" + s+"};";
            resHtml = resHtml.replace("</script>", "");
//            resHtml = resHtml.replace("eval", "return");
            resHtml = resHtml.replace("<script>", "");
            System.out.println(resHtml);

            se.eval(resHtml);
            Invocable invocable = (Invocable) se;
            String resJs = (String) invocable.invokeFunction("getClearance");
            //一级解密结果
            System.err.println(resJs);

            String overJs="function getClearance2(){ var a" + resJs.split("document.cookie")[1].split("Path=/;'")[0]+"Path=/;';return a;};";
            overJs=overJs.replace("window.headless", "''");
            System.out.println(overJs);
            se.eval(overJs);
            Invocable invocable2 = (Invocable) se;
            String over = (String) invocable2.invokeFunction("getClearance2");
            System.out.println(over);

        } catch (Exception e) {
            e.printStackTrace();
        }
    }

}
